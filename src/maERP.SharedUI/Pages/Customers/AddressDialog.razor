@using maERP.Domain.Dtos.CustomerAddress

<MudDialog>
    <TitleContent>
        <MudText Typo="Typo.h6">
            @(IsNew ? "Adresse hinzufügen" : "Adresse bearbeiten")
        </MudText>
    </TitleContent>
    <DialogContent>
        <MudForm @ref="form" Model="@Address">
            <MudGrid>
                <MudItem xs="6">
                    <MudTextField @bind-Value="Address.Firstname"
                                  For="@(() => Address.Firstname)"
                                  Label="Vorname"
                                  Variant="Variant.Text"
                                  Required="true">
                    </MudTextField>
                </MudItem>
                <MudItem xs="6">
                    <MudTextField @bind-Value="Address.Lastname"
                                  For="@(() => Address.Lastname)"
                                  Label="Nachname"
                                  Variant="Variant.Text"
                                  Required="true">
                    </MudTextField>
                </MudItem>
                <MudItem xs="12">
                    <MudTextField @bind-Value="Address.CompanyName"
                                  For="@(() => Address.CompanyName)"
                                  Label="Firma"
                                  Variant="Variant.Text">
                    </MudTextField>
                </MudItem>
                <MudItem xs="8">
                    <MudTextField @bind-Value="Address.Street"
                                  For="@(() => Address.Street)"
                                  Label="Straße"
                                  Variant="Variant.Text"
                                  Required="true">
                    </MudTextField>
                </MudItem>
                <MudItem xs="4">
                    <MudTextField @bind-Value="Address.HouseNr"
                                  For="@(() => Address.HouseNr)"
                                  Label="Hausnummer"
                                  Variant="Variant.Text"
                                  Required="true">
                    </MudTextField>
                </MudItem>
                <MudItem xs="4">
                    <MudTextField @bind-Value="Address.Zip"
                                  For="@(() => Address.Zip)"
                                  Label="PLZ"
                                  Variant="Variant.Text"
                                  Required="true">
                    </MudTextField>
                </MudItem>
                <MudItem xs="8">
                    <MudTextField @bind-Value="Address.City"
                                  For="@(() => Address.City)"
                                  Label="Ort"
                                  Variant="Variant.Text"
                                  Required="true">
                    </MudTextField>
                </MudItem>
                <MudItem xs="6">
                    <MudCheckBox @bind-checked="Address.DefaultDeliveryAddress"
                                 For="@(() => Address.DefaultDeliveryAddress)"
                                 Label="Standard-Lieferadresse"
                                 Color="Color.Primary">
                    </MudCheckBox>
                </MudItem>
                <MudItem xs="6">
                    <MudCheckBox @bind-checked="Address.DefaultInvoiceAddress"
                                 For="@(() => Address.DefaultInvoiceAddress)"
                                 Label="Standard-Rechnungsadresse"
                                 Color="Color.Primary">
                    </MudCheckBox>
                </MudItem>
            </MudGrid>
        </MudForm>
    </DialogContent>
    <DialogActions>
        <MudButton OnClick="Cancel">Abbrechen</MudButton>
        <MudButton Color="Color.Primary" OnClick="Submit" Variant="Variant.Filled">Speichern</MudButton>
    </DialogActions>
</MudDialog>

@code {
    private MudForm? form;
    
    [CascadingParameter] 
    IMudDialogInstance MudDialog { get; set; } = null!;
    
    [Parameter] 
    public CustomerAddressListDto Address { get; set; } = new();
    
    [Parameter]
    public bool IsNew { get; set; }
    
    private void Submit()
    {
        // Bei neuen Adressen eine temporäre negative ID vergeben
        if (IsNew)
        {
            // Tempöräre ID generieren (negativ, damit sie sich nicht mit existierenden IDs überschneiden)
            Address.Id = new Random().Next(-1000, -1);
        }
        
        MudDialog.Close(DialogResult.Ok(Address));
    }
    
    private void Cancel() => MudDialog.Cancel();
} 